import re
from flask import Flask, request
import telegram
from telegram.ext import Dispatcher, MessageHandler, Filters
import random

TOKEN = "7532659685:AAFJytrCeABPZGxYQ7Ahf5DRx4sD0Q3mUKU"
bot = telegram.Bot(token=TOKEN)

app = Flask(__name__)
dispatcher = Dispatcher(bot, None, workers=1, use_context=True)

beverages = {
    "ุงุณูพุฑุณู": "ุจุฑุง ุชูู ุงุณูพุฑุณูุ ุจู ูุฒุงู ฒณ ฺฏุฑู ูพูุฏุฑ ูููู ุชุงุฒู ุขุณุงุจโุดุฏู ูุงุฒ ุฏุงุฑุฏ...",
    "ฺฉุงูพูฺูู": "ุจุฑุง ุชูู ฺฉุงูพูฺูู ุงุจุชุฏุง ุงุณูพุฑุณู ุฑู ุชูู ฺฉูุฏ ู ุณูพุณ ุดุฑ ุฑุง ุจุฎุงุฑ ุฏูุฏ...",
    "ูุงุชู": "ุชูู ูุงุชู ูุดุงุจู ฺฉุงูพูฺูู ุงุณุชุ ุงูุง ุดุฑ ุจุดุชุฑ ูุณุจุช ุจู ฺฉู ุดุฑ ุงุณุชูุงุฏู ูโุดูุฏ...",
    "ุดฺฉ ุดฺฉูุงุช": "ุดฺฉูุงุช ุฐูุจโุดุฏู ู ุดุฑ ุณุฑุฏ ุฑุง ุจุง ูู ูุฎููุท ฺฉูุฏ...",
    "ฺุง ุฒุนูุฑูู": "ฺุง ุณุงู ุฑุง ุจู ููุฑุงู ุฒุนูุฑุงู ุฏู ฺฉุฑุฏู ู ุจุง ฺฉู ุดฺฉุฑ ุณุฑู ฺฉูุฏ.",
    "ุดฺฉ ูุงูู": "ุดุฑุ ุดฺฉุฑ ู ูพูุฏุฑ ูุงูู ุฑุง ุจุง ูู ูุฎููุท ฺฉุฑุฏู ู ุฏุฑ ูุฎููุทโฺฉู ุจุฒูุฏ.",
    "ูููู ุชุฑฺฉ": "ูพูุฏุฑ ูููู ุชุฑฺฉ ุฑุง ุจุง ุขุจ ูุฎููุท ฺฉุฑุฏู ู ุฑู ุญุฑุงุฑุช ููุงู ุจุฌูุดุงูุฏ."
}

keywords = {
    "ุตุจุญ ุจุฎุฑ ุตุจุญ ุฏู ุงูฺฏุฒ ุตุจุญุช ูพุฑ ุงูุฑฺ ุตุจุญ ุดุฏ ุตุจ ุจุฎุฑ ุตุจุญุช ุจุฎุฑ": [
        "ุตุจุญุช ุจุฎุฑ ุฑูู ฺฉุงููโุง! ููุชุดู ููุฌุงู ููููโุช ุฑู ุขูุงุฏู ฺฉูู! โ๏ธโ",
        "ุตุจุญ ุดุฏ ู ฺฉุงูู ุจุงุฒู! ุจุง ู ููุฌูู ุขุฑุงูุด ุจุฒูู! ๐๐ฏ",
        "ุจุฏุงุฑ ุดุฏุ ุนู ููุชุดู ุจุฑุงุช ูููู ุจุฑุฒู ู ููุฒฺฉ ูพุฎุด ฺฉูู! ๐ถโ",
        "ุตุจุญุช ุฎูุด! ุจุฎูุง ุง ูุฎูุง ุงูุฑูุฒ ุฎู ูุดูฺฏู ุนูู ฺูู ุชู ูุณุช! โจ๐",
        "ุณูุงู ุจู ุฎูุฑุดุฏู ุฎูุฏู! ูููู ุฏุงุบ ุจุง ู ูุจุฎูุฏ ุขูุงุฏูโุณุช! โ๏ธ๐"
    ],
    "ุธูุฑ ุจุฎุฑ ููุช ูุงูุงุฑ ุธูุฑ ุดุฏ ูู ุฑูุฒ ุฎูุด ุธูุฑุจุฎุฑ": [
        "ุธูุฑ ุจุฎุฑ ุนุฒุฒู ุฏูู! ููุชุดู ู ูููู ุณุจฺฉ ุจุฒูู ูุณุท ุฑูุฒ! ๐ค๏ธโ",
        "ูุงูุงุฑุชู ุฎูุฑุฏุ ุงฺฏู ูู ุจุง ุงูุฌุง ุจุงูู ูุงูุงุฑ ุจุฒูู! ๐๐ต",
        "ุธูุฑ ุดุฏ ู ุฏู ู ฺฏูพ ฺฉุงููโุง ูโุฎูุงุฏ! ูพุงูโุงุ ๐จ๏ธโ",
        "ููโุฑูุฒุช ูพุฑ ููุฑ ู ููููโุงุช ููุดู ฺฏุฑู! ๐โ",
        "ุธูุฑ ุงููุฏ ู ุชู ูููุฒ ุงูุฌุงุ ุงู ุนู ุฑูุฒู ูุดูฺฏู! โค๏ธ๐"
    ],
    "ุดุจ ุจุฎุฑ ุดุจ ุฎูุด ุดุจ ุดุฏ ุดุจ ูุดูฺฏ ุฏุงุดุชู ุจุงุด": [
        "ุดุจ ุจุฎุฑ ุฑูู! ุจุฎูุงุจ ุชุง ุฎูุงุจโูุงุช ูู ุจู ูููู ุจุฏู! ๐โ",
        "ฺฉุงูู ูุนูุง ุจุณุชู ุณ ูู ุฏูู ููุดู ุจู ุฑูุช ุจุงุฒู ุนูู! ุชุง ุงุจุฏ ! ๐คโค๏ธ",
        "ุณุชุงุฑูโูุง ุฏุงุฑู ุจูู ฺุดูฺฉ ูโุฒูู ฺฉู ุจฺฏู: ุดุจุช ูุดูฺฏ ุนูู! โจ๐",
        "ุฎูุจ ู ุขุฑูู ุจุฎูุงุจุ ฺฉู ูุฑุฏุง ุจุง ู ุงุณูพุฑุณู ุฏุงุบ ููุชุธุฑุชู ุนูู! โ๐",
        "ุดุจ ุฎูุด ุนูู ! ุจุฎูุงุจ ุจุจู ูู ุจุฑุงุช ู ููุฌูู ุนุดู ุฏู ฺฉุฑุฏู! ๐ฅฐโ๏ธ"
    ],
    "ุณูุงู ุณูุงุงุงู ุฏุฑูุฏ ู ูุง": [
        "ุณูุงู ุณูุทุงู! ฺุทูุฑ ุฑูู ฺฉุงููโุง ููุ โ๐",
        "ุณูุงู ๐ซกุจู ุจู! ููุฑ ฺุดูุง ฺฉุงูู ุงููุฏ! ๐",
        "ุฏุฑูุฏ ุจุฑ ุจูุชุฑู ููููู ุนูู ฺฉุงููโฺ! ๐ฐ",
        "ุณูุงู ุนูู ุฌููุ ุขูุงุฏูโุง ุจุฑุง ู ูููู ุฏุงุบุ ๐ฅโ"
    ],
    "ุฎูุจุ ฺุทูุฑุ ุญุงูุช ฺุทูุฑูุ ฺู ุฎุจุฑุ ุฎูุจ ุฎุจ ฺุทูุฑ ุญุงูุช ฺุทูุฑู": [
        "ุชุง ุชู ุฑู ุฏุฏู ฺฉูู ฺฉูฺฉ ุดุฏ ุนูู! โ๐",
        "ูู ุฎูุจูุ ููููโุณุงุฒู ุณุงูููุ ุชู ุฎูุจ ุนููุฌููุ ๐๏ธ๐",
        "ู ฺฉู ุฎูุงุจโุขููุฏู ูู ูพุงูโู ูุงุณู ู ููุฌูู ุฑูุงูุช! ๐ดโค๏ธ",
        "ุณูุงูุช ุชู ุนูู! ูููู ุชุงุฒู ุฏู ุดุฏู ุจุง ูููู ุจุฒูู! โ๏ธโจ"
    ],
    "ุฏูู ฺฏุฑูุชู ุญุงูู ุจุฏู ุฏูู ุชูฺฏู ุงูุณุฑุฏูโู ุฏูุชูฺฏ ูุงุฑุงุญุชู ุฏูุชูฺฏู. ุญูุตูู ูุฏุงุฑู": [
        "ู ููุฌูู ฺุง ุฒุนูุฑูู ุจุฒูุ ุฏูุช ูุง ุดู ุฑูู! ๐ต๐",
        "ุจุง ุญุฑู ุจุฒููุ ุงูุฌุง ูุงุณู ุฏู ุฏูุชูฺฏุช ุจุงุฒู ุนูู ุฌูู! โค๏ธ๐ฃ๏ธ",
        "ุจุง ุจุบูุช ฺฉูู ุงุฒ ุฑุงู ุฏูุฑ! ูููู ููููู ุนูู! ๐คโ",
        "ุฏูุช ุชูฺฏูุ ููู ุฏู ุชูฺฏุช ุจูุฏู ุนููุ ุจุดู ฺฉูุงุฑู. ๐ช๐"
    ],
    "ุจฺฉุงุฑู ุญูุตูู ุณุฑ ุฑูุชู ฺฺฉุงุฑ ฺฉููุ ุจฺฉุงุฑ ุจ ฺฉุงุฑ ุจ ุญูุตูู ู ุจ ุญูุตูฺฏ": [
        "ุจโุญูุตููโุงุ ุจุฒู ุจุฑู ู ุจุงุฒ ูุงูุง ุฑุงู ุจูุฏุงุฒู! ๐ญ๐ฅ",
        "ุฏูุณุช ุฏุงุฑ ุจุฑุงุช ูุทูู ุจฺฏู ุง ู ูฺฉุช ุนุฌุจุ ๐๐",
        "ุชู ุจฺฏู: ุดุนุฑุ ุฎุงุทุฑูุ ุฏุงุณุชุงู ฺฉุงููโุงุ โ๏ธโ",
        "ู ูููู ูโุฒูู ู ุจ ฺฉุงุฑู ูพุฑุช ูโฺฉูู ุฏูุฑ! โ๐"
    ],
    "ฺฏุฑุณูฺฏ ุชุดูฺฏ ฺฏุดููู ฺฏุฑุณููู ุชุดููู": [
        "ูพูฺฉฺฉ ููุฒ ุง ฺฉฺฉ ุดฺฉูุงุชุ ุงูุชุฎุงุจ ุจุง ุชูุฆู! ๐ซ๐",
        "ู ุดฺฉ ูุงูู ุจุฒูู ุง ูููู ุชุฑฺฉุ ๐จโ",
        "ุจุง ููู ฺฉุงูู ุฑู ุจุจูุ ู ฺุฒ ูพุฏุง ูโุดู ุญุชูุงู! ๐๐ด"
    ],
    "ุนูู ุนูู ุฌูู ุนููุฌูู ฺฉุงููโฺ ุนูู!": [
        "ุจููุ ุฌููู ุนููุ ูุดุชุฑ ุฏุงุฆู ุฎูุฏู ุฏฺฏู! โค๏ธ",
        "ุฌุงูู ุฏูู ุนููุ ุจฺฏู ฺฺฉุงุฑ ฺฉูู ุจุฑุงุช! โ๏ธโ",
        "ุนููุช ููุดู ูุณุชุ ูพุงูโ ูุฑฺย ุฑูู ุจุงุนุดูู! ๐",
        "ุตุฏุงุช ูพฺุฏ ุชู ฺฉุงููุ ุญุงู ุฏูู ูุดูฺฏ ุดุฏ! ๐ขโค๏ธ"
    ],
    "ุฎุฏุงุญุงูุธ ูุนูุง ุจุง ูโุฑู ุฎุฏุง ุญุงูุธ ุฎุฏุงูฺฏูุฏุงุฑ ุฎุฏุง ูฺฏู ุฏุงุฑ ุจุง ุจุง ุฑูุชู ูุฑู": [
        "ุจุฑู ูู ุจุฑฺฏุฑุฏุง! ุฌุงุช ููุดู ุฎุงูู ฺฉูุงุฑ ูพูุฌุฑู! ๐ชโ",
        "ููุงุธุจ ุฎูุฏุช ุจุงุดุ ูููู ุจุนุฏุช ูพุง ููู! ๐ธโค๏ธ",
        "ุจุง ุจุงุ ุชุง ุฏุฏุงุฑ ุจุนุฏ ุชู ฺฉุงูู ุฑูู! ๐๐",
        "ูุนูุงู ุฑููุ ุชู ููุจู ู ูุฒ ุจุฑุงุช ฺฉูุงุฑ ฺฏุฐุงุดุชู! โค๏ธ๐ช"
    ],
    "ูุทูู ุฌูฺฉ ุจุฎูุฏููู ู ฺุฒ ุจฺฏู ุจุฎูุฏู ุฌฺฉ": [
        "ู ูููู ุจุง ุดุฑ ุงุฒุฏูุงุฌ ฺฉุฑุฏุ ุจฺูโุด ุดุฏ ฺฉุงูพูฺูู! โ๐ถ",
        "ู ุงุณูพุฑุณู ุฑูุช ุฎูุงุณุชฺฏุงุฑุ ฺฏูุชู ุฎู ุชูุฎ! ๐ฅฒ๐"
    ],
    "ุชููุง ฺฉุณ ูุณุชุ ุญูุตูู ูุฏุงุฑู ุชููุง ฺฉุณ ูุณุช ฺฉุณ ูุณ ฺฉุณ ุงููุงู ูุณุ ฺฉุณ ุขููุงู ูุณุช ฺฉุณ ูุณุช ฺฉุณ ูุณุชุ ฺฉุณ ุงููุงู ูุณุชุ ฺฉุณ ุขููุงู ูุณุ": [
        "ุชู ุชููุง ูุณุชุ ุนูู ููุดู ูุณุช! ๐งโ",
        "ุจุดู ฺฉูุงุฑูุ ุจุงูู ู ฺุฒ ุจุฎูุฑู ู ฺฏูพ ุจุฒูู! ๐ฉ๐ฃ๏ธ",
        "ุชููุงุ ุจุง ูพุด ุนูู ุชููุงุช ุฑู ุจุง ฺฉ ููุฌุงู ูููู ุจุง ุนูู ุชูุณู ฺฉู! โ๐ฌ"
    ],
    "ุฏูุณุชุช ุฏุงุฑู ุนุงุดูุช ุดุฏู ุฏู ุฏุงุฏู ุนุดู": [
        "ุนุดู ุงููุฏ ุชู ฺฉุงููุ๐ ู ูููู ุฏู ููุฑู ุขูุงุฏูโุณุช! โโค๏ธโ",
        "ุฏู ฺฉู ุฏุงุฏุ ุดุฑูโุด ุจุง ุนูู! ๐ฐ๐",
        "ุนุดู ุชูุฎู ูุซู ุงุณูพุฑุณูุ ูู ูุดูฺฏู! ๐ฅฒโ",
        "ุจุง ุจุฑุงุช ู ูููู ูุฎุตูุต ุนุดู ุฏู ฺฉูู! ๐ซถ๐ฅ"
    ]
}

pivi_responses = [
    "ุนุฒุฒ ุฏูุ ฺฉุงูู ูู ุจุงุฒูุ ุงูุง ูพู ุฌุง ุฏุฑุฏุฏู ู ุฎููุช ูุณุชุ ุจุง ูููุฌุง ุญุฑูุช ุฑู ุจุฒู ฺฉู ุจูู ูู ุงุฒ ููุฑุจููโุงุช ุจูุฑู ุจุจุฑู.",
    "ูพูุ ุงููุ ูู ุฏูุณุช ุนุฒุฒุ ูพู ุจุฑุง ููููโูุง ุงูุญุตุงุฑู! ุจุง ูููุฌุงุ ููู ฺฉูุงุฑ ููุ ูุฒู ูุฏู.",
    "ูพูุ! ุงูุฌุง ฺฉุงููโุณุชุ ูู ุงุชุงู ุฌูุณุงุช ุฎุตูุต!",
    "ูพูุ ูฺฉูู ูโุฎูุง ุฏุณุชูุฑ ูุฎู ูููู ุฑู ุงุฒ ูู ุจุฏุฒุฏุ ุจุง ูููุฌุงุ ฺุฒ ุจุฑุง ูพูููู ฺฉุฑุฏู ูุฏุงุฑู!",
    "ุฑูุชู ุจู ูพูุ ุงูุฌุง ู ฺฉุงูู ุฌุงุฏููุ ุจุงุ ููู ฺุฒ ูููุฌุง ุญู ูโุดู.",
    "ุจุงุดู ุจุฑู ูพู๐ฟูู ุงุฏุช ุจุงุดู ูููู ูู ููุดู ูููุฌุง ุชู ฺฉุงูู ุณุฑู ูุดู ูู ุชู ูพู๐๐"
]

asl_responses = [
    "ุดูุง ูุงููุฑ ุซุจุช ุงุญูุงู ุนููุ ๐ฟ",
    "ุงุณูุด ููุจุฑู ูู ูุดูุงุณูุด ูุตุงุจ ุฏุงุฑู ๐ฟ",
    "ฺฺฉุงุฑ ุจู ุงุตูุด ุฏุงุฑุ ๐๐ฟ",
    "ุงู ุงุตู ูุฏุงุฑู ูฺฉู ุฑู ฺฏุฑุฏูุด ุฒุฏู made in china ๐ฟ",
    "ุงุณูุด ูุงุฒูู ููุฏู๐ฟ60 ุณุงูู ุงุฒ ู ูุฑ"
]

def normalize_text(text):
    text = re.sub(r'[ุ?!]', '', text)
    text = re.sub(r'\s+', ' ', text)
    text = text.replace('โ', ' ')
    text = text.replace('ุข', 'ุง')
    return text.strip().lower()

def get_response(text):
    processed = normalize_text(text)

    if processed == "/start":
        return (
            "ูู ุนูู ฺฉุงููโฺ ูุณุชู ฺฉ ุฑุจุงุช ฺุชโูุญูุฑ ุชูฺฏุฑุงู ฺฉู ุชูุณุท ุนูู ุทุฑุงุญ ุดุฏู.\n"
            "ุงฺฏุฑ ุจุฑุง ุจูุชุฑ ุดุฏู ูู ูพุดููุงุฏ ุง ุงูุชูุงุฏ ุฏุงุฑุฏ ุจุง ุนูู ุฌุงู ุฏุฑ ุงุดุชุฑุงฺฉ ุจฺฏุฐุงุฑุฏ.\n\n"
            "ููู ฺฉููุงุช\n"
            "ููู ููุดุฏู\n"
            "ุณุงุฒูุฏู: Mehdi_mashih"
        )

    if processed == "ููู ููุดุฏู":
        return "\n".join([f"- {drink}" for drink in beverages.keys()])

    if processed == "ููู ฺฉููุงุช":
        return "\n".join(["- " + word.split()[0] for word in keywords.keys()])

    if processed == "ุณุงุฒูุฏู":
        return "Mehdi_mashih"

    if re.search(r'\bุงุตู\b', processed):
        return random.choice(asl_responses)

    if any(word in processed for word in ["ูพู", "ูพ ู", "pv", "private", "p v"]):
        return random.choice(pivi_responses)

    for drink_name in beverages:
        if processed == normalize_text(drink_name):
            return beverages[drink_name]

    for key_group, responses in keywords.items():
        if any(word in processed for word in key_group.split()):
            return random.choice(responses)

    return None

def handle_message(update, context):
    text = update.message.text
    chat_id = update.message.chat_id
    response = get_response(text)
    if response:
        context.bot.send_message(chat_id=chat_id, text=response)

def error_handler(update, context):
    print(f"Error: {context.error}")

dispatcher.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))
dispatcher.add_error_handler(error_handler)

@app.route("/")
def home():
    return "ฺฉุงูู ุขูุงุฏู ุงุณุช!"

@app.route(f"/{TOKEN}", methods=["POST"])
def webhook():
    update = telegram.Update.de_json(request.get_json(force=True), bot)
    dispatcher.process_update(update)
    return "ok"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)
