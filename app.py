import os
import random
import re
import asyncio
from flask import Flask, request
from telegram import Update
from telegram.ext import Application, MessageHandler, ContextTypes, filters

TOKEN = "7532659685:AAFJytrCeABPZGxYQ7Ahf5DRx4sD0Q3mUKU"

app = Flask(__name__)
application = Application.builder().token(TOKEN).build()

keywords = {
    ("ุตุจุญ ุจุฎุฑ", "ุตุจุญุช ุจุฎุฑ", "ุตุจุญ ุฏู ุงูฺฏุฒ", "ุตุจุญุช ูพุฑ ุงูุฑฺ", "ุตุจุญ ุดุฏ", "ุตุจ ุจุฎุฑ"): [
        "ุตุจุญุช ุจุฎุฑ ุฑูู ฺฉุงููโุง! ููุชุดู ููุฌุงู ููููโุช ุฑู ุขูุงุฏู ฺฉูู!",
        "ุตุจุญ ุดุฏ ู ฺฉุงูู ุจุงุฒู! ุจุง ู ููุฌูู ุขุฑุงูุด ุจุฒูู!",
    ],
    ("ุธูุฑ ุจุฎุฑ", "ููุช ูุงูุงุฑ", "ุธูุฑ ุดุฏ", "ูู ุฑูุฒ ุฎูุด", "ุธูุฑุจุฎุฑ"): [
        "ุธูุฑ ุจุฎุฑ ุนุฒุฒ ุฏูู! ููุชุดู ู ูููู ุณุจฺฉ ุจุฒูู ูุณุท ุฑูุฒ!",
        "ูุงูุงุฑุชู ุฎูุฑุฏุ ุงฺฏู ูู ุจุง ุงูุฌุง ุจุงูู ูุงูุงุฑ ุจุฒูู!",
    ],
    ("ุดุจ ุจุฎุฑ", "ุดุจ ุฎูุด", "ุดุจ ุดุฏ", "ุดุจ ูุดูฺฏ ุฏุงุดุชู ุจุงุด"): [
        "ุดุจ ุจุฎุฑ ุฑูู! ุจุฎูุงุจ ุชุง ุฎูุงุจโูุงุช ูู ุจู ูููู ุจุฏู!",
        "ฺฉุงูู ูุนูุง ุจุณุชูโุณ ูู ุฏูู ููุดู ุจู ุฑูุช ุจุงุฒู ุนูู!",
    ],
    ("ุณูุงู", "ุณูุงุงุงู", "ุฏุฑูุฏ", "ู", "ูุง"): [
        "ุณูุงู ุณูุทุงู! ฺุทูุฑ ุฑูู ฺฉุงููโุง ููุ",
        "ุณูุงู! ููุฑ ฺุดูุง ฺฉุงูู ุงููุฏ!",
        "ุจู ุจู! ููููู ุฏุงุฑู! ุจุง ุจุดู ฺฉูุงุฑ ุจุฎุงุฑ โ๐ฅ",
        "ุฏุฑูุฏ ุจุฑ ุฌุงู ฺฉุงููโฺ! ๐๐ฉ"
    ],
    ("ุฎูุจุ", "ฺุทูุฑุ", "ุญุงูุช ฺุทูุฑูุ", "ฺู ุฎุจุฑุ", "ุฎูุจ", "ุฎุจ", "ฺุทูุฑ", "ุญุงูุช ฺุทูุฑู"): [
        "ูู ุฎูุจูุ ููููโุณุงุฒู ุณุงูููุ ุชู ุฎูุจ ุนููุฌููุ",
        "ุณูุงูุช ุชู ุนูู! ูููู ุชุงุฒู ุฏู ุดุฏู ุจุง ูููู ุจุฒูู!",
        "ูู ุฎูุจู ุงฺฏู ุชู ุญุงูุช ุฎูุจ ุจุงุดู! โค๏ธ๐ค",
        "ุญุงูู ุจู ุฏูุง ููููโุณุช... ููุช ุชูุ ููุดู ฺฏุฑูู! ๐ฅ๐"
    ],
    ("ุฏูู ฺฏุฑูุชู", "ุญุงูู ุจุฏู", "ุฏูู ุชูฺฏู", "ุงูุณุฑุฏูโู", "ุฏูุชูฺฏ", "ูุงุฑุงุญุชู", "ุฏูุชูฺฏู", "ุญูุตูู ูุฏุงุฑู"): [
        "ู ููุฌูู ฺุง ุฒุนูุฑูู ุจุฒูุ ุฏูุช ูุง ุดู ุฑูู!",
        "ุจุง ุญุฑู ุจุฒููุ ุงูุฌุง ูุงุณู ุฏู ุฏูุชูฺฏุช ุจุงุฒู ุนูู ุฌูู!",
        "ุจุฎุงุฑ ูููู ฺฏุงู ุงุฒ ุจุฎุงุฑ ุงุดฺฉ ุขุฑููโุชุฑู... โ๐ฅ",
        "ุนูู ฺฏูุดุงุด ุจุงุฒูุ ุจฺฏู ฺ ุดุฏู... ๐ง๐ค",
        "ู ููุฌูู ุงูุฏ ุจุง ุนุทุฑ ูู ูุงุณู ุฏูุช ุฏู ฺฉุฑุฏู ๐ตโจ"
    ],
    ("ูพู", "ูพ ู", "pv", "private", "p v"): [
        "ูพูุ ุงููุ ูู ุฏูุณุช ุนุฒุฒุ ูพู ุจุฑุง ููููโูุง ุงูุญุตุงุฑู!",
        "ูพูุ! ุงูุฌุง ฺฉุงููโุณุชุ ูู ุงุชุงู ุฌูุณุงุช ุฎุตูุต!",
    ],
    ("ุงุตู",): [
        "ุงุณูุด ูุงุฒูู ููุฏูุ ถฐ ุณุงูุดู ุงุฒ ู ูุฑ!",
        "ฺฺฉุงุฑ ุจู ุงุตูุด ุฏุงุฑุ ูฺฉู ุฑู ฺฏุฑุฏูุด ุฒุฏู made in china!",
    ],
    ("ูููู",): [
        "ูููู ุฏุงุบุ ฺุง ูุจโุณูุฒ ุง ุฏูููุด ุดุจุ ุงูุชุฎุงุจ ุจุง ุชูุฆู ๐ตโ๐ฟ",
        "ููุดุฏู ูุฎุตูุต ุงูุดุจ: ยซุฏูโุขุฑุงูยป ุจุง ุทุนู ูุงูู ู ุฏู ูุทุฑู ุงูุฏ โจ๐ง",
        "ุจฺฏู ููุท ุชูุฎ ุง ุดุฑูุ ุจุงูโุด ุจุง ุนูู ๐ซโ"
    ],
    ("ุนุดู",): [
        "ุนุดู ููููโุงู ฺฉู ุญุช ุงฺฏู ุณุฑุฏ ุจุดูุ ุฎุงุทุฑูโุด ฺฏุฑูู โค๏ธโ",
        "ุนูู ุฎูุฏุด ู ุฏู ุจุงุฎุชูโุณุช... ุจุง ุจุง ูู ุจููุดู ๐๐ท",
        "ุฏูุช ุชูพุฏุ ุจุง ุจุดู ฺฉูุงุฑ ูพูุฌุฑู... ุจุงุฏ ุญุฑูุชู ูโุฑุณููู ๐ช๐ฌ"
    ],
    ("ุดุนุฑ",): [
        "ยซุฏุฑ ุงู ุณุฑุง ุจโฺฉุณุ ฺฉุณ ุจู ุฏุฑ ููโุฒูุฏ...ยป ๐๐",
        "ุจุช ุงูุดุจ ุจุง ุนุทุฑ ูููู ูุงุท ุดุฏู: ยซุชู ุฑุง ูู ฺุดู ุฏุฑ ุฑุงูู...ยป โ๐",
        "ุดุงุนุฑ ุดุฏุ ุจููุณุ ูู ูู ุจุฎููู ฺฉูุงุฑ ูููู ๐โ๏ธ"
    ],
    ("ุชููุง",): [
        "ุชููุง ฺฏุงู ููุฏู ุฎูุจูุ ูุฎุตูุตุงู ููุช ฺฉูุงุฑ ูููู ุจุงุดู ๐โ",
        "ุชู ุชููุง ูุณุช... ฺฉุงูู ููุดู ฺุฑุงุบ ุฏุงุฑู ุจุฑุงุช ๐ฏ๐ซถ",
        "ู ููุฌูู ุชููุง ุจุฎูุฑ ุง ุนูู ูู ุจุดูู ฺฉูุงุฑุชุ ๐ช๐"
    ],
    ("ุฑูู", "ุฏูุณุช"): [
        "ุฑูู ุฌุงู! ุตูุฏู ููุดฺฏุช ูููุฒ ฺฏุฑู ูููุฏู ๐ชโค๏ธ",
        "ูููู ุจุง ุฏูุณุช ูุฒูโ ุฏฺฏูโุง ุฏุงุฑูุ ููุ ๐ต๐ฌ",
        "ููุฑุงู ุนู ฺฉ ุญุฑู ูุฒูู ูู ุจุงุดู... ูุซู ูููู ุจโุดุฑู ๐ค๐ค"
    ],
    ("ุดูุฎ",): [
        "ู ุจุงุฑ ูููู ุนุงุดู ุดุฑ ุดุฏุ ฺฏูุชู ุงุฒ ุงูู ูููุน ูุฒูโุด ูุฑูโุชุฑ ุดุฏู! โ๐",
        "ุจุฎูุฏ ุฑูู! ุฏู ุนูู ููุช ุชู ุจุฎูุฏ ููุฏ ูโุฑุฒู! ๐ฌ๐",
        "ฺฉุงููโุง ฺฉู ูุฎูุฏูุ ููุท ู ุงูุจุงุฑ ุชูุฎู! ๐๐ช"
    ],
    ("ููุฒฺฉ",): [
        "ุจุฐุงุฑ ู ููุฒฺฉ ุฌูุฒ ุจุฐุงุฑูุ ููููโุชู ุชู ุญุงู ุฎูุฏุด ุจุงุดู ๐ถโ",
        "ููุณู ู ููููุ ุชุฑฺฉุจ ุจโุฑูุจ ุชููุงุง ุดุจ ๐๐ง",
        "ุงูุดุจ ุขููฺฏ ุณูุช ุง ุจููุฒุ ุงูุชุฎุงุจ ุจุง ุชู ๐ป๐บ"
    ],
    ("ุจุงุฑูู",): [
        "ุจุงุฑูููุ ุจุง ุฌูู ุดูููู... ูููู ุจุง ุตุฏุง ุจุงุฑูู ูโฺุณุจู ๐ง๏ธ๐ฅ",
        "ููุง ุงุจุฑุ ู ฺุชุฑ ฺฉููู ูโุฎูุงุฏ... ุจุง ุชู ฺฉุงูู ๐โ๏ธ",
        "ูุฑ ูุทุฑูโ ุจุงุฑูู ู ุดุนุฑู ฺฉู ูููุฒ ูุฎููุฏุด... ๐ง๐"
    ],
    ("ุฎูุงุจ",): [
        "ู ุฏูููุด ุขุฑุงูุด ุฏู ฺฉุฑุฏูุ ุจุฎูุฑ ู ุจุนุฏุด ู ฺูุฑุช ๐ด๐ต",
        "ุจุฎูุงุจ ุง ุจุฏุงุฑ ุจุงุดุ ฺฉุงูู ุจุฑุงุช ุฑูุดูู ๐๐ค",
        "ุฎูุงุจ ุฏุฏ ุจุง ุนูู ุฑูุช ุณูุฑ ููููุ ุจุง ุจุฏุงุฑ ุดู! โ๏ธโ"
    ],
    ("ุจุฏุงุฑ",): [
        "ูููุฒ ุจุฏุงุฑุ ูพุณ ุจุง ุฏู ููุฌูู ููููโ ุดุจุงูู ููููู ุจุงุด โ๐",
        "ุดุจุง ฺฉุงูู ุจุง ุฑููุง ุจุฏุงุฑ ูุดูฺฏโุชุฑู ๐๐ฏ",
        "ุชุง ุฏุฑ ููุช ุจูููุ ุนูู ุญุฑู ุฏุงุฑู ูุงุณุช... ๐๐ฌ"
    ],
    ("ุญุงู ุฎูุจ",): [
        "ุญุงู ุฎูุจ ุนู ู ููุฌูู ฺฏุฑู ุจุง ู ุฌููู ุขุฑููโุฏููุฏู โ๐",
        "ุจุง ู ุดุงุช ุงูุฑฺ ุจุฑุฒู ุชู ููุฌููุช! โก๐ต",
        "ุฏูุช ุจุฎูุฏูุ ููุฌููุช ูุจโุฑุฒ ุดู ุงุฒ ุฎูุด ๐โ"
    ],
    ("ูุงู",): [
        "ูุงูุช ูโฺฏู ู ุงุชูุงู ุฎูุจ ุจุง ุทุนู ูููู ุฏุงุฑู ูุงุฏ! ๐ฎโ",
        "ุจุฎูุฑ ููููโุชูุ ุจุนุฏุด ูุนูุจฺฉ ุฑู ุจุฑุงุช ูโฺุฑุฎููู ุจุจูู ฺ ุชูุดู ๐ซ๐๏ธ",
        "ููุฌููุช ุชูุด ู ููุจ ุฏุงุดุช... ฺฉ ุชู ูฺฉุฑุช ุจูุฏูุ โค๏ธโ๐ฅ"
    ],
    ("ุฎุงุทุฑู",): [
        "ู ุฌุฑุนู ุจููุด... ุฎุงุทุฑูโุด ุฎูุฏุด ูุงุฏ ุจุงูุง ๐ฐ๏ธโ",
        "ุงุฏุชู ุงูู ุฑูุฒ ฺฉู... ุจโุฎุงู! ุจุง ููุท ุจุดู ู ุจุฎูุฏ ๐๐ธ",
        "ฺฏุฐุดุชู ููุฏ ูุณุช ูู ููููโุด ูููุฒ ุชูุฎู ๐ฌโ๐"
    ],
    ("ููููู",): [
        "ุจู ฺฉุงูู ุฎูุด ุงููุฏ! ูููู ุงูู ููุดู ูููููู ุนููุฆู โ๐",
        "ู ุชุงุฒูโูุงุฑุฏ ุฏุงุฑูุ ุตูุฏู ุทูุง ุจุงุฑู! ๐๐ช",
        "ูุฏูุช ุฑู ฺุดู! ุจูุฑูุงุ ููู ุฏุณุช ุฑุงุณุชุชู ๐๐"
    ],
    ("ููู",): [
        "ููู ุงูุดุจ: ูููู ุนุดูุ ฺุง ุฑูุงูุชุ ุฏูููุด ุขุฑุงูุด โ๐",
        "ุฏูุจุงู ุทุนู ุฎุงุต ูุณุชุ ุจฺฏู ุชุง ุชุฑฺฉุจ ฺฉูู! ๐งช๐ต",
        "ููุดุฏู ุจุง ุทุนู ุดุนุฑุ ุง ู ุฌุฑุนู ููุณููุ ๐โ"
    ],
    ("ฺฉุชุงุจ",): [
        "ฺฉุชุงุจ ุจุฎูู ุจุง ููููุ ุจูุชุฑู ูุฑุงุฑ ุดุจุงููโุณุช ๐โ",
        "ุฏุงุณุชุงู ูโุฎูุงุ ุนุงุดูุงูู ุง ูพูุณุ ูู ุจูุฏู! ๐๐",
        "ฺฉุชุงุจ ุจโูููู ูุซู ฺฉุงูู ุจโุนุทุฑู... ๐๐"
    ]
}

def normalize_text(text):
    text = re.sub(r'[ุ?!]', '', text)
    text = re.sub(r'\s+', ' ', text)
    text = text.replace('โ', ' ')
    text = text.replace('ุข', 'ุง')
    return text.strip().lower()

def get_response(text):
    processed = normalize_text(text)
    if processed == "/start":
        return (
            "ูู ุนูู ฺฉุงููโฺ ูุณุชู!\n"
            "ุณุงุฒูุฏู: Mehdi_mashih\n"
            "ุจุฑุง ุฏุฏู ูุณุช ฺฉููุงุชุ ุจูุฑุณุช: ููู ฺฉููุงุช"
        )
    if processed == "ููู ฺฉููุงุช":
        return "\n".join(["- " + list(group)[0] for group in keywords.keys()])
    if processed == "ุณุงุฒูุฏู":
        return "Mehdi_mashih"
    for key_group, responses in keywords.items():
        for keyword in key_group:
            if keyword in processed:
                return random.choice(responses)
    return None

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message:
        return
    text = message.text
    chat_id = message.chat.id
    message_id = message.message_id
    response = get_response(text)
    if response:
        await context.bot.send_message(chat_id=chat_id, text=response, reply_to_message_id=message_id)

application.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_message))

@app.route("/")
def home():
    return "ฺฉุงูู ุขููุงูู ุนูู ูุนุงูู!"

@app.route(f"/{TOKEN}", methods=["POST"])
def webhook():
    update = Update.de_json(request.get_json(force=True), application.bot)
    asyncio.run(application.initialize())
    asyncio.run(application.process_update(update))
    return "ok"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)

