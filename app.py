import re

def handle_message(update, context):
    text = update.message.text.strip().lower()

    # لیست پاسخ‌ها بر اساس الگوهای متنی
    responses = [
        (r'سلام+', [
            "سلام به روی ماهت عموجون",
            "سلام سلطان!! خوش اومدی",
            "سلام و صدتا سلام عمو🌹 جون 😍",
            "علیک سلام عمو جون، باد آمد و بوی عنبر آورد😁😍"
        ]),
        (r'چ\s?خبر', ["خبرا که پیش شماست عموجون!"]),
        (r'کسی آنلاین نیست', ["من آنلاینم عموجون 😍 کاری داشتی؟"]),
        (r'عمو\s?جون', [
            "جان دلم عمو؟ بگو ببینم چی شده!",
            "جانم عموجون؟ 😍 چیزی میل داری؟",
            "بفرمایید عموجون، یه قهوه گرم مخصوص شما☕️",
            "عموجون بفرما بشین، قهوه تازه و داغ با کیک تازه برات بیارم😁😍"
        ]),
        (r'\bاصل\b(?!.*اصلاح)', ["شما مامور ثبت احوالی؟ 😂😐"]),
        (r'بیا پی[ _]?وی', ["پیوی خطرناکه حسن😂🗿"]),
        (r'(خداحافظ|خدانگهدار|بای)', [
            "خدانگهدار ستون😁🌹",
            "فعلا مواظب خودت باش سلطان ❤"
        ]),
        (r'(گشنمه|گرسنمه)', ["چی میل داری عموجون؟ 😋"]),
        (r'منو(?:ی)?\sکافه', None),  # برای نمایش منو جداگانه هندل می‌کنیم
    ]

    # چک کردن پاسخ‌ها با regex
    for pattern, reply in responses:
        if re.search(pattern, text):
            if reply:
                update.message.reply_text(random.choice(reply))
            else:
                keywords = list(recipes.keys())
                update.message.reply_text("کلمات کلیدی منوی کافه:\n- " + '\n- '.join(keywords))
            return

    # چک کردن اسم نوشیدنی‌ها
    for item in recipes:
        if item in text:
            update.message.reply_text(recipes[item])
            return

    # در صورت عدم تطابق با هیچ چیزی
    update.message.reply_text("عموجون درست نفهمیدم چی گفتی، یه چیز دیگه بگو ببینم!")
